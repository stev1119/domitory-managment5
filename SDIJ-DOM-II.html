<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œëŒ€ì¸ì¬ ê¸°ìˆ™ì‚¬ í•™ìƒì •ë³´ ê²€ìƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #581c87 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .header-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .header-text {
            text-align: left;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            margin: 0;
        }

        .header p {
            font-size: 1.2rem;
            color: #6b7280;
            margin: 5px 0 0 0;
        }

        /* ê²€ìƒ‰ ì„¹ì…˜ */
        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .search-box {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 15px 25px 15px 50px;
            border: 3px solid #e5e7eb;
            border-radius: 50px;
            font-size: 1.1rem;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 5px rgba(79, 70, 229, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            font-size: 1.2rem;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }

        .search-result-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: #f8fafc;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .result-room {
            font-weight: 600;
            color: #4f46e5;
            font-size: 1rem;
        }

        .result-name {
            font-weight: 500;
            color: #1f2937;
            margin: 2px 0;
        }

        .result-status {
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* ì „ì²´ í†µê³„ ì¹´ë“œ */
        .total-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-card.total { border-left-color: #10b981; }
        .stat-card.out { border-left-color: #f59e0b; }
        .stat-card.new { border-left-color: #3b82f6; }
        .stat-card.move { border-left-color: #8b5cf6; }
        .stat-card.absent { border-left-color: #6b7280; }
        .stat-card.exit { border-left-color: #ef4444; }

        .stat-card h3 {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        /* ì„±ë³„ í†µê³„ */
        .gender-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .gender-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .gender-section h3 {
            text-align: center;
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #1f2937;
            font-weight: 600;
        }

        .gender-section.male {
            border-left: 5px solid #3b82f6;
        }

        .gender-section.female {
            border-left: 5px solid #ec4899;
        }

        .gender-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
        }

        .gender-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gender-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .gender-card .number {
            font-size: 1.6rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .gender-card .label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
        }

        /* ë™ë³„ í†µê³„ */
        .building-stats {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .building-stats h3 {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: #1f2937;
            font-weight: 600;
        }

        .buildings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .building-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #4f46e5;
        }

        .building-header {
            text-align: center;
            margin-bottom: 15px;
        }

        .building-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .building-type {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .floor-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .floor-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .floor-card:hover {
            border-color: #4f46e5;
            background: #fefefe;
        }

        .floor-card .floor-name {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .floor-card .floor-count {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* êµ¬ì—­ë³„ ë‹´ë‹¹ì í˜„í™© ìŠ¤íƒ€ì¼ */
        .manager-stats {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .manager-stats h3 {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 25px;
            color: #1f2937;
            font-weight: 600;
        }

        .area-info-summary {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-radius: 12px;
        }

        .area-info-summary p {
            color: #6b7280;
            font-size: 1rem;
            margin: 0;
            font-weight: 500;
        }

        .area-managers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
        }

        .building-group {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 20px;
            padding: 25px;
            border-left: 5px solid #6366f1;
        }

        .building-group-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .building-group-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .building-group-subtitle {
            font-size: 1rem;
            color: #6b7280;
            font-weight: 500;
        }

        .floors-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .area-manager-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #6366f1;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .area-manager-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border-left-color: #4f46e5;
        }

        .area-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e5e7eb;
        }

        .area-manager-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
        }

        .area-manager-zone {
            font-size: 0.9rem;
            color: #6366f1;
            font-weight: 600;
            background: rgba(99, 102, 241, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
        }

        .area-stats-compact {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .area-stat-item {
            background: white;
            border-radius: 8px;
            padding: 8px 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .area-stat-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .area-stat-item.current { border-color: #10b981; }
        .area-stat-item.out { border-color: #f59e0b; }
        .area-stat-item.new { border-color: #3b82f6; }
        .area-stat-item.absent { border-color: #6b7280; }
        .area-stat-item.move-out { border-color: #ef4444; }
        .area-stat-item.move-in { border-color: #8b5cf6; }
        .area-stat-item.exit { border-color: #dc2626; }

        .area-stat-number {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 2px;
        }

        .area-stat-label {
            font-size: 0.65rem;
            color: #6b7280;
            font-weight: 500;
        }

        .area-total-summary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

 .area-building-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(99, 102, 241, 0.15);
    color: #4f46e5;
    padding: 8px 20px;
    border-radius: 16px;
    font-size: 1.4rem;
    font-weight: 700;
    pointer-events: none;
   
}
      

        /* í•™ìƒ ì •ë³´ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .modal-body {
            padding: 20px;
        }

        .students-grid {
            display: grid;
            gap: 15px;
        }

        .student-info-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #4f46e5;
            transition: all 0.3s ease;
        }

        .student-info-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .student-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-room {
            font-size: 1.1rem;
            font-weight: 700;
            color: #4f46e5;
        }

        .student-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }

        .status-normal { background: #10b981; }
        .status-out { background: #f59e0b; }
        .status-new { background: #3b82f6; }
        .status-move { background: #8b5cf6; }
        .status-absent { background: #6b7280; }
        .status-exit { background: #ef4444; }

        .student-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 2px;
        }

.detail-value {
    white-space: pre-wrap;
    word-wrap: break-word;
    word-break: break-word;
    max-width: 100%;
    line-height: 1.6;
    min-height: auto;
    overflow: visible;
}

.counsel-record {
    background: #f8fafc;
    padding: 12px;
    border-radius: 8px;
    margin: 8px 0;
    border-left: 3px solid #3b82f6;
    white-space: pre-wrap;
    word-wrap: break-word;
}

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .header-text {
                text-align: center;
            }

            .header-logo {
                width: 50px;
                height: 50px;
            }

            .total-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .gender-stats {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .buildings-grid {
                grid-template-columns: 1fr;
            }

            .student-details {
                grid-template-columns: 1fr;
            }

            .floor-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f4f6;
            border-top: 5px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="header-content">
                <!-- êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì´ë¯¸ì§€ë¡œë“œ ë“œëŸ½ê²Œ ì˜¤ë¥˜ë§ë„¤ ì •ë§ -->
                <img src="https://lh3.googleusercontent.com/d/1Zt7J__aLz3uQF02JX3zs0BQtx60OC5bJ" alt="ì‹œëŒ€ì¸ì¬ ë¡œê³ " class="header-logo" 
                     onerror="this.onerror=null; this.src='https://drive.google.com/uc?export=download&id=1Zt7J__aLz3uQF02JX3zs0BQtx60OC5bJ'; 
                              setTimeout(() => { if(!this.complete || this.naturalWidth === 0) { this.src='https://docs.google.com/uc?export=download&id=1Zt7J__aLz3uQF02JX3zs0BQtx60OC5bJ'; 
                              setTimeout(() => { if(!this.complete || this.naturalWidth === 0) { this.style.display='none'; this.nextElementSibling.style.display='inline'; } }, 1000); } }, 1000);">
                <!-- ë¡œê³  ë¡œë“œ ì‹¤íŒ¨ì‹œ ëŒ€ì²´ í…ìŠ¤íŠ¸ -->
                <span style="display: none; font-size: 2.5rem;">ğŸ«</span>
                <div class="header-text">
                    <h1>ì‹œëŒ€ì¸ì¬ ê¸°ìˆ™ì‚¬ í•™ìƒì •ë³´ ê²€ìƒ‰</h1>
                    <p>í•™ìƒ ì •ë³´(í‡´ì›ìƒí¬í•¨) ë° ê¸°ìˆ™ì‚¬ ìƒë‹´ ê²€ìƒ‰          </p>
                </div>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="search-section">
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" id="searchInput" placeholder="í•™ìƒ ì´ë¦„, ê¸°ìˆ™ì‚¬ ë²ˆí˜¸, ë¼ë¸Œ ì¢Œì„ë²ˆí˜¸,ì „ë²ˆ ë“±ìœ¼ë¡œ ê²€ìƒ‰...">
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>
<div style="text-align: center; margin-top: 15px;">
    <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer; font-size: 1rem; color: #f5f5f5; font-weight: 700;">
        <input type="checkbox" id="extendedSearchCheckbox" style="width: 22px; height: 22px; cursor: pointer;">
        <span>ğŸ” í™•ì¥ ê²€ìƒ‰ (í´ë¦­í›„ ê²€ìƒ‰ì–´ ì…ë ¥ì‹œ : ê¸°ìˆ™ì‚¬ì´ë™ì´ë ¥ â˜…í‡´ì›ìƒ ê²€ìƒ‰: í´ë¦­í›„,ì´ë¦„ ë˜ëŠ” ìˆ«ì4ìë¦¬(íœ´ëŒ€í°)ì…ë ¥)</span>
    </label>
</div>
        <!-- ì „ì²´ í†µê³„ -->
        <div class="total-stats" id="totalStats"style="display: none;">
            <div class="stat-card total" onclick="showStudentsByStatus('total')">
                <h3>ì´ í˜„ì¬ì›</h3>
                <div class="number" id="totalCurrent">0</div>
                <div class="label">ì „ì²´ ì¬í•™ìƒ</div>
            </div>
            <div class="stat-card out" onclick="showStudentsByStatus('ì™¸ë°•')">
                <h3>ì™¸ë°•</h3>
                <div class="number" id="totalOut">0</div>
                <div class="label">ì™¸ë°• ì¤‘ì¸ í•™ìƒ</div>
            </div>
            <div class="stat-card new" onclick="showStudentsByStatus('ì‹ ê·œ')">
                <h3>ì‹ ê·œ</h3>
                <div class="number" id="totalNew">0</div>
                <div class="label">ì‹ ê·œ ì…ì†Œ</div>
            </div>
            <div class="stat-card move" onclick="showStudentsByStatus('ì´ë™')">
                <h3>ì´ë™</h3>
                <div class="number" id="totalMove">0</div>
                <div class="label">ì´ë™ ì˜ˆì •/ì™„ë£Œ</div>
            </div>
            <div class="stat-card absent" onclick="showStudentsByStatus('ë“±ë¯¸')">
                <h3>ë“±ë¯¸</h3>
                <div class="number" id="totalAbsent">0</div>
                <div class="label">ë“±ë¡ ë¯¸ì…ì†Œ</div>
            </div>
            <div class="stat-card exit" onclick="showStudentsByStatus('í‡´ì†Œ')">
                <h3>í‡´ì†Œ</h3>
                <div class="number" id="totalExit">0</div>
                <div class="label">í‡´ì†Œ ì²˜ë¦¬</div>
            </div>
        </div>

        <!-- ì„±ë³„ í†µê³„ -->
        <div class="gender-stats"style="display: none;">
            <div class="gender-section male">
                <h3>ë‚¨í•™ìƒ í˜„í™©</h3>
                <div class="gender-cards" id="maleStats">
                    <div class="gender-card" onclick="showStudentsByGender('male', 'total')">
                        <div class="number" id="maleCurrent">0</div>
                        <div class="label">í˜„ì¬ì›</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('male', 'ì™¸ë°•')">
                        <div class="number" id="maleOut">0</div>
                        <div class="label">ì™¸ë°•</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('male', 'ì‹ ê·œ')">
                        <div class="number" id="maleNew">0</div>
                        <div class="label">ì‹ ê·œ</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('male', 'ë“±ë¯¸')">
                        <div class="number" id="maleAbsent">0</div>
                        <div class="label">ë“±ë¯¸</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('male', 'ì´ë™-')">
                        <div class="number" id="maleMoveOut">0</div>
                        <div class="label">ì´ë™-</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('male', 'ì´ë™+')">
                        <div class="number" id="maleMoveIn">0</div>
                        <div class="label">ì´ë™+</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('male', 'í‡´ì†Œ')">
                        <div class="number" id="maleExit">0</div>
                        <div class="label">í‡´ì†Œ</div>
                    </div>
                </div>
            </div>
            <div class="gender-section female" style="display: none;">
                <h3>ì—¬í•™ìƒ í˜„í™©</h3>
                <div class="gender-cards" id="femaleStats">
                    <div class="gender-card" onclick="showStudentsByGender('female', 'total')">
                        <div class="number" id="femaleCurrent">0</div>
                        <div class="label">í˜„ì¬ì›</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('female', 'ì™¸ë°•')">
                        <div class="number" id="femaleOut">0</div>
                        <div class="label">ì™¸ë°•</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('female', 'ì‹ ê·œ')">
                        <div class="number" id="femaleNew">0</div>
                        <div class="label">ì‹ ê·œ</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('female', 'ë“±ë¯¸')">
                        <div class="number" id="femaleAbsent">0</div>
                        <div class="label">ë“±ë¯¸</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('female', 'ì´ë™-')">
                        <div class="number" id="femaleMoveOut">0</div>
                        <div class="label">ì´ë™-</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('female', 'ì´ë™+')">
                        <div class="number" id="femaleMoveIn">0</div>
                        <div class="label">ì´ë™+</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByGender('female', 'í‡´ì†Œ')">
                        <div class="number" id="femaleExit">0</div>
                        <div class="label">í‡´ì†Œ</div>
                    </div>
                </div>
            </div>
        </div>
<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ í†µê³„ -->
        <div class="gender-stats" style="display: none;">
            <div class="gender-section" style="border-left: 5px solid #f59e0b;">
                <h3>Aë¼ì´ë¸ŒëŸ¬ë¦¬ í˜„í™©</h3>
                <div class="gender-cards" id="libraryAStats">
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'total')">
                        <div class="number" id="libraryACurrent">0</div>
                        <div class="label">í˜„ì¬ì›</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'ì™¸ë°•')">
                        <div class="number" id="libraryAOut">0</div>
                        <div class="label">ì™¸ë°•</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'ì‹ ê·œ')">
                        <div class="number" id="libraryANew">0</div>
                        <div class="label">ì‹ ê·œ</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'ë“±ë¯¸')">
                        <div class="number" id="libraryAAbsent">0</div>
                        <div class="label">ë“±ë¯¸</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'ì´ë™-')">
                        <div class="number" id="libraryAMoveOut">0</div>
                        <div class="label">ì´ë™-</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'ì´ë™+')">
                        <div class="number" id="libraryAMoveIn">0</div>
                        <div class="label">ì´ë™+</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('A', 'í‡´ì†Œ')">
                        <div class="number" id="libraryAExit">0</div>
                        <div class="label">í‡´ì†Œ</div>
                    </div>
                </div>
            </div>
            <div class="gender-section" style="border-left: 5px solid #10b981;">
                <h3>Bë¼ì´ë¸ŒëŸ¬ë¦¬ í˜„í™©</h3>
                <div class="gender-cards" id="libraryBStats">
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'total')">
                        <div class="number" id="libraryBCurrent">0</div>
                        <div class="label">í˜„ì¬ì›</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'ì™¸ë°•')">
                        <div class="number" id="libraryBOut">0</div>
                        <div class="label">ì™¸ë°•</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'ì‹ ê·œ')">
                        <div class="number" id="libraryBNew">0</div>
                        <div class="label">ì‹ ê·œ</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'ë“±ë¯¸')">
                        <div class="number" id="libraryBAbsent">0</div>
                        <div class="label">ë“±ë¯¸</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'ì´ë™-')">
                        <div class="number" id="libraryBMoveOut">0</div>
                        <div class="label">ì´ë™-</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'ì´ë™+')">
                        <div class="number" id="libraryBMoveIn">0</div>
                        <div class="label">ì´ë™+</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('B', 'í‡´ì†Œ')">
                        <div class="number" id="libraryBExit">0</div>
                        <div class="label">í‡´ì†Œ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cë¼ì´ë¸ŒëŸ¬ë¦¬ í†µê³„ (ì „ì²´ ë„ˆë¹„) -->
        <div class="gender-stats" " style="display: none;">
            <div class="gender-section" style="border-left: 5px solid #8b5cf6;"style="display: none;">
                <h3>Cë¼ì´ë¸ŒëŸ¬ë¦¬ í˜„í™©</h3>
                <div class="gender-cards" id="libraryCStats"style="display: none;">
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'total')">
                        <div class="number" id="libraryCCurrent">0</div>
                        <div class="label">í˜„ì¬ì›</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'ì™¸ë°•')">
                        <div class="number" id="libraryCOut">0</div>
                        <div class="label">ì™¸ë°•</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'ì‹ ê·œ')">
                        <div class="number" id="libraryCNew">0</div>
                        <div class="label">ì‹ ê·œ</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'ë“±ë¯¸')">
                        <div class="number" id="libraryCAbsent">0</div>
                        <div class="label">ë“±ë¯¸</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'ì´ë™-')">
                        <div class="number" id="libraryCMoveOut">0</div>
                        <div class="label">ì´ë™-</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'ì´ë™+')">
                        <div class="number" id="libraryCMoveIn">0</div>
                        <div class="label">ì´ë™+</div>
                    </div>
                    <div class="gender-card" onclick="showStudentsByLibrary('C', 'í‡´ì†Œ')">
                        <div class="number" id="libraryCExit">0</div>
                        <div class="label">í‡´ì†Œ</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- êµ¬ì—­ë³„ ë‹´ë‹¹ì í˜„í™© (24ê°œ êµ¬ì—­) -->
        <div class="manager-stats"style="display: none;">
            <h3>ê° ë™,ì¸µë³„ ì¸ì› í˜„í™© </h3>
            <div class="area-info-summary">
                <p>Aë™~Fë™ê¹Œì§€ ê° ì¸µë³„ ë‹´ë‹¹ì ë° í˜„í™©</p>
            </div>
            <div class="area-managers-grid" id="areaManagersGrid">
                <!-- êµ¬ì—­ë³„ ë‹´ë‹¹ì ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë¡œë”© -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <!-- í•™ìƒ ì •ë³´ ëª¨ë‹¬ -->
    <div class="modal" id="studentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">í•™ìƒ ìƒì„¸ ì •ë³´</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="students-grid" id="modalStudentsGrid">
                    <!-- í•™ìƒ ì •ë³´ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
let sheetsData = [];
let afSheetData = [];
let exitedStudentsData = [];  // í‡´ì†Œí•™ìƒ ë°ì´í„° ì¶”ê°€
let reportData = {};
let searchTimeout;

        // ê¸°ìˆ™ì‚¬ ì •ë³´ ì •ì˜
        const buildingInfo = {
            'A': { name: 'Aë™', type: '(ì—¬)ì´ê´„:ìœ ë‚˜ê²½T', gender: 'female' },
            'B': { name: 'Bë™', type: '(ë‚¨)ì´ê´„:ì´ì‹œìš°T', gender: 'male' },
            'C': { name: 'Cë™', type: '(ë‚¨)ì´ê´„:ê³ ìŠ¹ì™„T', gender: 'male' },
            'D': { name: 'Dë™', type: '(ë‚¨)ì´ê´„:ë‚¨ì¸ë‹¬T', gender: 'male' },
            'E': { name: 'Eë™', type: '(ì—¬)ì´ê´„:ê¹€í˜œì •T', gender: 'female' },
            'F': { name: 'Fë™', type: '(ë‚¨)ì´ê´„:ì´ì‹œìš°T', gender: 'male' }
        };

        // ë‹´ë‹¹ìë³„ ë‹´ë‹¹ êµ¬ì—­ ì •ë³´ (24ê°œ êµ¬ì—­ìœ¼ë¡œ í™•ì¥)
        const managerInfo = {
            'ì´ìœ¤ë¯¼T': ['Aë™1ì¸µ'],
            'ê¹€ì •ì•„T': ['Aë™2ì¸µ'],
            'ê¹€ë¯¸ê²½T': ['Aë™3ì¸µ'],
            'ìœ ë‚˜ê²½T': ['Aë™4ì¸µ'],
            'ê¹€ì„ì§„T': ['Bë™1ì¸µ'],
            'ê¹€ì„ì§„T2': ['Bë™2ì¸µ'],
            'ê¹€ê±´í¬T': ['Bë™3ì¸µ'],
            'ìµœë¬¸ê·œT': ['Bë™4ì¸µ'],
            'í™©ë¯¼ì² T': ['Cë™1ì¸µ'],
            'ìµœê¸ˆì£¼T': ['Cë™2ì¸µ'],
            'ë‚˜ì •ìš°T': ['Cë™3ì¸µ'],
            'ê³ ìŠ¹ì™„T': ['Cë™4ì¸µ'],
            'ì´ìƒë¯¼T': ['Dë™1ì¸µ'],
            'ì´ìƒë¯¼T2': ['Dë™2ì¸µ'],
            'ë‚¨ì¸ë‹¬T': ['Dë™3ì¸µ'],
            'ê¹€ì˜í˜„T': ['Dë™4ì¸µ'],
            'ì´ì€ì˜T': ['Eë™1ì¸µ'],
            'ì›í˜„ì£¼T': ['Eë™2ì¸µ'],
            'ì§„ì •í˜„T': ['Eë™3ì¸µ'],
            'ê¹€í˜œì •T': ['Eë™4ì¸µ'],
            'ì¡°ì˜ê¶ŒT': ['Fë™1ì¸µ'],
            'ì¡°ì˜ê¶ŒT2': ['Fë™2ì¸µ'],
            'ì´ì‹œìš°T': ['Fë™3ì¸µ'],
            'ì´ì˜ìš´T': ['Fë™4ì¸µ']
        };

        // 3ì¸ì‹¤ ì…€ ë²”ìœ„
        const tripleRoomRanges = {
            'A': { start: 188, end: 432 },
            'B': { start: 406, end: 468 },
            'C': { start: 654, end: 749 },
            'D': { start: 884, end: 952 },
            'E': { start: 1185, end: 1304 },
            'F': { start: 1403, end: 1453 }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” 
        window.addEventListener('load', async function() {
            console.log('ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘...');
            
            // ì§ì ‘ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ
            showLoading(true);
            try {
                console.log('ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                
                // ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
                const sheetsLoaded = await loadSheetsData();
// AFì‹œíŠ¸ ë°ì´í„° ë¡œë“œ (í™•ì¥ ê²€ìƒ‰ìš©)
await loadAFSheetData();
                // í‡´ì†Œí•™ìƒ ë°ì´í„° ë¡œë“œ (í™•ì¥ ê²€ìƒ‰ìš©)
await loadExitedStudentsData();
                if (!sheetsLoaded) {
                    throw new Error('ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
                
                // ë³´ê³  ë°ì´í„° ì´ˆê¸°í™” (localStorageì—ì„œ ì§ì ‘ ì²˜ë¦¬)
                try {
                    const savedData = localStorage.getItem('reportData');
                    reportData = savedData ? JSON.parse(savedData) : {};
                    console.log('ë³´ê³  ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (storageError) {
                    console.warn('ë³´ê³  ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨, ë¹ˆ ê°ì²´ë¡œ ì„¤ì •:', storageError);
                    reportData = {};
                }
                
                // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
                updateDashboard();
                
                showLoading(false);
                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showLoading(false);
                
                // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                const loadingEl = document.getElementById('loading');
                loadingEl.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3 style="color: #ef4444; margin-bottom: 20px;">âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                        <p style="color: #6b7280; margin-bottom: 20px;">${error.message}</p>
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            ğŸ”„ ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
                loadingEl.style.display = 'block';
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            // ì£¼ê¸°ì  ìƒˆë¡œê³ ì¹¨ ì„¤ì • (5ë¶„ë§ˆë‹¤)
            setInterval(async () => {
                console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰...');
                await refreshData();
            }, 5 * 60 * 1000);
        });

        // ë°ì´í„° ë¡œë“œ (ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”)
        async function loadData() {
            showLoading(true);
            try {
                console.log('ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                
                // ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
                const sheetsLoaded = await loadSheetsData();
                if (!sheetsLoaded) {
                    throw new Error('ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
                
                // ë³´ê³  ë°ì´í„° ë¡œë“œ
                loadReportData();
                
                // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
                updateDashboard();
                
                showLoading(false);
                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showLoading(false);
                
                // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                const loadingEl = document.getElementById('loading');
                loadingEl.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3 style="color: #ef4444; margin-bottom: 20px;">âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                        <p style="color: #6b7280; margin-bottom: 20px;">ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ë‚˜ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                            ğŸ”„ ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
                loadingEl.style.display = 'block';
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ (ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”)
        function updateDashboard() {
            try {
                console.log('ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ì‹œì‘...');
                
                if (!sheetsData || sheetsData.length === 0) {
                    console.error('ì‹œíŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    throw new Error('ì‹œíŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                const stats = calculateStats();
                
                if (!stats) {
                    console.error('í†µê³„ ê³„ì‚° ì‹¤íŒ¨');
                    throw new Error('í†µê³„ ê³„ì‚° ì‹¤íŒ¨');
                }

                updateTotalStats(stats);
                updateGenderStats(stats);
                updateLibraryStats(stats);  // ë¼ì´ë¸ŒëŸ¬ë¦¬ í†µê³„ ì—…ë°ì´íŠ¸ ì¶”ê°€
                updateAreaManagerStats(stats);  // êµ¬ì—­ë³„ ë‹´ë‹¹ì í†µê³„ ì—…ë°ì´íŠ¸
                
                console.log('ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            } catch (error) {
                console.error('ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                throw error; // ìƒìœ„ë¡œ ì˜¤ë¥˜ ì „íŒŒ
            }
        }

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            try {
                console.log('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
                const sheetsLoaded = await loadSheetsData();
                if (sheetsLoaded) {
                    updateDashboard();
                    console.log('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (ì„ íƒì‚¬í•­)
                    showTemporaryMessage('âœ… ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }
            } catch (error) {
                console.error('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                showTemporaryMessage('âŒ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì„ì‹œ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showTemporaryMessage(message, type) {
            const messageEl = document.createElement('div');
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 9999;
                animation: slideIn 0.3s ease;
                ${type === 'success' ? 'background: linear-gradient(135deg, #10b981, #059669);' : 'background: linear-gradient(135deg, #ef4444, #dc2626);'}
            `;
            messageEl.textContent = message;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(messageEl);
                }, 300);
            }, 3000);
        }

        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì¶”ê°€
        function addRefreshButton() {
            const header = document.querySelector('.header');
            const refreshBtn = document.createElement('button');
            refreshBtn.innerHTML = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨(F5)';
            refreshBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                background: linear-gradient(135deg, #4f46e5, #7c3aed);
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 0.9rem;
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
                transition: all 0.3s ease;
            `;
            
            refreshBtn.addEventListener('click', async () => {
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨ ì¤‘...';
                await refreshData();
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨(F5)';
            });
            
            header.style.position = 'relative';
            header.appendChild(refreshBtn);
        }

        // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì¶”ê°€ (í˜ì´ì§€ ë¡œë“œ í›„)
        setTimeout(() => {
            try {
                addRefreshButton();
            } catch (error) {
                console.log('ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì¶”ê°€ ì‹¤íŒ¨:', error);
            }
        }, 2000);

        // êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ 
        async function loadSheetsData() {
            try {
                console.log('ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹œë„ ì¤‘...');
                
                // ë°©ë²• 1: ê³µê°œ ì‹œíŠ¸ CSV ë°©ì‹
                const csvUrl = `https://docs.google.com/spreadsheets/d/1RqPfs1VbguAP85a9uswfLeUdYVAGye6GIKr0tvg4oYc/export?format=csv&gid=0`;
                
                try {
                    console.log('CSV ë°©ì‹ìœ¼ë¡œ ì‹œë„ ì¤‘...');
                    const csvResponse = await fetch(csvUrl);
                    
                    if (csvResponse.ok) {
                        const csvText = await csvResponse.text();
                        const allData = parseCSV(csvText);
                        
                        // B3ë¶€í„° ì‹œì‘í•˜ëŠ” ë°ì´í„°ë§Œ ì¶”ì¶œ (B=2ë²ˆì§¸ ì—´, 3=3ë²ˆì§¸ í–‰)
                        sheetsData = [];
                        
                        // í—¤ë” (B3:P3)
                        if (allData.length > 2 && allData[2].length > 1) {
                            const header = allData[2].slice(1, 23); // B3:P3 (Bì—´=1ë²ˆ ì¸ë±ìŠ¤ë¶€í„° Pì—´=15ë²ˆ ì¸ë±ìŠ¤ê¹Œì§€)
                            sheetsData.push(['ì¸ë±ìŠ¤'].concat(header)); // ì¸ë±ìŠ¤ ì—´ ì¶”ê°€
                        }
                        
                        // ë°ì´í„° (B4ë¶€í„°)
                        for (let i = 3; i < allData.length; i++) {
                            if (allData[i].length > 1) {
                                const row = allData[i].slice(1, 23); // Bì—´:Pì—´
                                if (row.some(cell => cell && cell.trim() !== '')) { // ë¹ˆ í–‰ì´ ì•„ë‹Œ ê²½ìš°ë§Œ
                                    sheetsData.push([i].concat(row)); // í–‰ ë²ˆí˜¸ì™€ í•¨ê»˜ ì¶”ê°€
                                }
                            }
                        }
                        
                        console.log('CSV ë°©ì‹ ì„±ê³µ:', sheetsData.length, 'í–‰ (í—¤ë” í¬í•¨)');
                        return true;
                    }
                } catch (csvError) {
                    console.log('CSV ë°©ì‹ ì‹¤íŒ¨, API ë°©ì‹ìœ¼ë¡œ ì „í™˜:', csvError);
                }
                
                // ë°©ë²• 2: Google Sheets API ë°©ì‹ (ì˜¬ë°”ë¥¸ ë²”ìœ„)
                const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/1RqPfs1VbguAP85a9uswfLeUdYVAGye6GIKr0tvg4oYc/values/yulee!B3:V1000?key=AIzaSyAAaDiNQC3o779j_4pzVC4ouuZr48Y-PbY`;
                
                console.log('API ë°©ì‹ìœ¼ë¡œ ì‹œë„ ì¤‘... (ë²”ìœ„: B3:P1000)');
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (403 Forbidden)');
                    } else if (response.status === 404) {
                        throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œíŠ¸ê°€ ê³µê°œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. (404 Not Found)');
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                }
                
                const data = await response.json();
                
                if (!data.values || data.values.length === 0) {
                    throw new Error('B3:P1000 ë²”ìœ„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // APIì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼  ë³€í™˜
                sheetsData = [];
                
                // í—¤ë” ì¶”ê°€ (ì²« ë²ˆì§¸ í–‰)
                sheetsData.push(['ì¸ë±ìŠ¤'].concat(data.values[0])); 
                
                // ë°ì´í„° ì¶”ê°€ (ë‚˜ë¨¸ì§€ í–‰ë“¤)
                for (let i = 1; i < data.values.length; i++) {
                    const row = data.values[i];
                    if (row && row.length > 0 && row.some(cell => cell && cell.trim() !== '')) {
                        sheetsData.push([i + 3].concat(row)); // ì‹¤ì œ ì‹œíŠ¸ í–‰ ë²ˆí˜¸ (B4ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +3)
                    }
                }
                
                console.log('API ë°©ì‹ ì„±ê³µ:', sheetsData.length, 'í–‰ (í—¤ë” í¬í•¨)');
                console.log('ì²« 5í–‰ ë°ì´í„°:', sheetsData.slice(0, 5));
                return true;
                
            } catch (error) {
                console.error('ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                
                //  í•´ê²°í–ˆëŠ”ë°..ë„ë°ì²´... 
                const loadingEl = document.getElementById('loading');
                loadingEl.innerHTML = `
                    <div style="text-align: center; padding: 40px; max-width: 600px; margin: 0 auto;">
                        <h3 style="color: #ef4444; margin-bottom: 20px;">âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                        <p style="color: #6b7280; margin-bottom: 15px; line-height: 1.6;">
                            <strong>ì˜¤ë¥˜:</strong> ${error.message}
                        </p>
                        <div style="background: #f3f4f6; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                            <h4 style="color: #374151; margin-bottom: 10px;">í™•ì¸ì‚¬í•­:</h4>
                            <ol style="color: #6b7280; margin-left: 20px; line-height: 1.8;">
                                <li><strong>ë°ì´í„° ìœ„ì¹˜:</strong> B3ë¶€í„° í—¤ë”ê°€ ì‹œì‘í•˜ê³  B4ë¶€í„° ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸</li>
                                <li><strong>êµ¬ê¸€ ì‹œíŠ¸ ê³µê°œ:</strong> ì‹œíŠ¸ ìš°ìƒë‹¨ "ê³µìœ " â†’ "ë§í¬ê°€ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì"</li>
                                <li><strong>ì‹œíŠ¸ ì´ë¦„:</strong> í•˜ë‹¨ íƒ­ì´ ì •í™•íˆ "yulee"ì¸ì§€ í™•ì¸</li>
                                <li><strong>ë„¤íŠ¸ì›Œí¬:</strong> ì¸í„°ë„· ì—°ê²° ìƒíƒœ í™•ì¸</li>
                            </ol>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="location.reload()" style="padding: 12px 24px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                                ğŸ”„ ë‹¤ì‹œ ì‹œë„
                            </button>
                            <button onclick="tryDemoData()" style="padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                                ğŸ“‹ ë°ëª¨ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
                            </button>
                        </div>
                    </div>
                `;
                loadingEl.style.display = 'block';
                return false;
            }
        }

        // CSV íŒŒì‹± í•¨ìˆ˜
        // CSV íŒŒì‹± í•¨ìˆ˜ (ì¤„ë°”ê¿ˆ í¬í•¨ ì…€ ì²˜ë¦¬ ê°œì„ )
function parseCSV(csv) {
    const result = [];
    let current = '';
    let inQuotes = false;
    let row = [];
    
    for (let i = 0; i < csv.length; i++) {
        const char = csv[i];
        const nextChar = csv[i + 1];
        
        if (char === '"') {
            if (inQuotes && nextChar === '"') {
                // ì—°ì†ëœ ë”°ì˜´í‘œ("")ëŠ” í•˜ë‚˜ì˜ ë”°ì˜´í‘œë¡œ ì²˜ë¦¬
                current += '"';
                i++; // ë‹¤ìŒ ë”°ì˜´í‘œ ê±´ë„ˆë›°ê¸°
            } else {
                // ë”°ì˜´í‘œ ì‹œì‘/ì¢…ë£Œ
                inQuotes = !inQuotes;
            }
        } else if (char === ',' && !inQuotes) {
            // ì‰¼í‘œë¡œ ì…€ êµ¬ë¶„ (ë”°ì˜´í‘œ ë°–ì—ì„œë§Œ)
            row.push(current);
            current = '';
        } else if (char === '\n' && !inQuotes) {
            // ì¤„ë°”ê¿ˆìœ¼ë¡œ í–‰ êµ¬ë¶„ (ë”°ì˜´í‘œ ë°–ì—ì„œë§Œ)
            row.push(current);
            if (row.length > 0 && row.some(cell => cell.trim() !== '')) {
                result.push(row);
            }
            row = [];
            current = '';
        } else if (char === '\r') {
            // \rì€ ë¬´ì‹œ (Windows ì¤„ë°”ê¿ˆ ì²˜ë¦¬)
            if (nextChar !== '\n' && !inQuotes) {
                row.push(current);
                if (row.length > 0 && row.some(cell => cell.trim() !== '')) {
                    result.push(row);
                }
                row = [];
                current = '';
            }
        } else {
            // ì¼ë°˜ ë¬¸ì ì¶”ê°€ (ë”°ì˜´í‘œ ì•ˆì˜ ì¤„ë°”ê¿ˆ í¬í•¨)
            current += char;
        }
    }
    
    // ë§ˆì§€ë§‰ ì…€ê³¼ í–‰ ì²˜ë¦¬
    if (current || row.length > 0) {
        row.push(current);
        if (row.length > 0 && row.some(cell => cell.trim() !== '')) {
            result.push(row);
        }
    }
    
    return result;
}
// AFì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
async function loadAFSheetData() {
    try {
        console.log('AFì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
        const csvUrl = `https://docs.google.com/spreadsheets/d/1jvpvDwXLEHAok31_cGaWintGgD0kSkoPIzxBquYgkIc/export?format=csv&gid=62521893`;
        
        const csvResponse = await fetch(csvUrl);
        if (csvResponse.ok) {
            const csvText = await csvResponse.text();
            const allData = parseCSV(csvText);
            afSheetData = [];
            
            for (let i = 0; i < allData.length; i++) {
                if (allData[i].length > 6) {
                    const bCol = allData[i][1] || '';
                    const dCol = allData[i][3] || '';
                    const gCol = allData[i][6] || '';
                    
                    if (bCol || gCol) {
                        afSheetData.push({
                            nameB: bCol.trim(),
                            nameG: gCol.trim(),
                            note: dCol.trim()
                        });
                    }
                }
            }
            console.log('AFì‹œíŠ¸ ë¡œë“œ ì„±ê³µ:', afSheetData.length, 'í–‰');
            return true;
        }
    } catch (error) {
        console.error('AFì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
        return false;
    }
}
        // í‡´ì†Œí•™ìƒ ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
// í‡´ì†Œí•™ìƒ ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ
async function loadExitedStudentsData() {
    try {
        console.log('í‡´ì†Œí•™ìƒ ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
        
        // API ë°©ì‹ìœ¼ë¡œ ì‹œë„ (í‡´ì†Œí•™ìƒ ì‹œíŠ¸ì˜ GID í™•ì¸ í•„ìš”)
        const spreadsheetId = '1NuB6N-kdJUXfQgYh3VM6TIfbIIMQj6NvvCNU4TGSJYw';
        const sheetName = 'IF';  // ì‹œíŠ¸ ì´ë¦„
        const range = 'B:Z';  // Bì—´ë¶€í„° Zì—´ê¹Œì§€ ëª¨ë“  ë°ì´í„°
        const apiKey = 'AIzaSyAAaDiNQC3o779j_4pzVC4ouuZr48Y-PbY';
        
        const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}!${range}?key=${apiKey}`;
        
        console.log('í‡´ì†Œí•™ìƒ API í˜¸ì¶œ:', apiUrl);
        const response = await fetch(apiUrl);
        
        if (response.ok) {
            const data = await response.json();
            
            if (data.values && data.values.length > 0) {
                exitedStudentsData = [];
                
                // ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”ë¡œ ê°€ì •
                const headers = data.values[0];
                console.log('í‡´ì†Œí•™ìƒ ì‹œíŠ¸ í—¤ë”:', headers);
                
                // í—¤ë” ë‹¤ìŒ í–‰ë¶€í„° ë°ì´í„° ì²˜ë¦¬
                for (let i = 1; i < data.values.length; i++) {
                    const row = data.values[i];
                    
                    // Bì—´(ì¸ë±ìŠ¤ 0)ê³¼ Cì—´(ì¸ë±ìŠ¤ 1)ì—ì„œ ì´ë¦„ í™•ì¸
                    const nameB = row[0] || '';
                    const nameC = row[1] || '';
                    
                    // ì´ë¦„ì´ ìˆëŠ” í–‰ë§Œ ì €ì¥
                    if (nameB.trim() || nameC.trim()) {
                        exitedStudentsData.push({
                            rowIndex: i + 1,  // ì‹¤ì œ ì‹œíŠ¸ í–‰ ë²ˆí˜¸
                            name: nameB.trim() || nameC.trim(),
                            fullRow: row,
                            headers: headers
                        });
                    }
                }
                
                console.log('í‡´ì†Œí•™ìƒ ì‹œíŠ¸ ë¡œë“œ ì„±ê³µ:', exitedStudentsData.length, 'í–‰');
                console.log('ì²« 3ê°œ ìƒ˜í”Œ:', exitedStudentsData.slice(0, 3));
                return true;
            } else {
                console.warn('í‡´ì†Œí•™ìƒ ì‹œíŠ¸ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
        } else {
            console.error('í‡´ì†Œí•™ìƒ ì‹œíŠ¸ API í˜¸ì¶œ ì‹¤íŒ¨:', response.status);
            return false;
        }
        
    } catch (error) {
        console.error('í‡´ì†Œí•™ìƒ ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
        return false;
    }
}
        // ë°ëª¨ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function tryDemoData() {
            console.log('ë°ëª¨ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // ê°„ë‹¨í•œ ë°ëª¨ ë°ì´í„° ìƒì„±
            sheetsData = [
                ['í—¤ë”', 'ê¸°ìˆ™ì‚¬ë²ˆí˜¸', 'ì´ë¦„', 'ìƒíƒœ', 'ë‚ ì§œ', 'ë©”ëª¨', 'í•™ë¶€ëª¨ì—°ë½ì²˜', 'ë³¸ì¸ì—°ë½ì²˜', 'ë¼ì´ë¸ŒëŸ¬ë¦¬ì¢Œì„', 'ìƒí™œë‹´ì„', '', 'ìƒë…„ì›”ì¼', 'ì„±ë³„', 'ì…ì†Œì¼', 'ì¶œì‹ ê³ êµ', 'ë°˜'],
                ['1', 'A101', 'ê¹€ì² ìˆ˜', 'ì •ìƒ', '2025-01-02', '', '010-1234-5678', '010-9876-5432', 'L001', 'í™ê¸¸ë™', '', '2005-03-15', 'ë‚¨', '2024-03-01', 'ì„œìš¸ê³ ', '1-1'],
                ['2', 'A102', 'ì´ì˜í¬', 'ì™¸ë°•', '2025-01-02', 'ê°€ì¡± ë°©ë¬¸', '010-2345-6789', '010-8765-4321', 'L002', 'í™ê¸¸ë™', '', '2005-05-20', 'ì—¬', '2024-03-01', 'ë¶€ì‚°ê³ ', '1-1'],
                ['3', 'B201', 'ë°•ë¯¼ìˆ˜', 'ì‹ ê·œ', '2025-01-02', '', '010-3456-7890', '010-7654-3210', 'L003', 'ê¹€ì„ ìƒ', '', '2005-07-10', 'ë‚¨', '2025-01-02', 'ëŒ€êµ¬ê³ ', '1-2'],
                ['4', 'D301', 'ìµœìˆ˜ì§„', 'ì •ìƒ', '2025-01-02', '', '010-4567-8901', '010-6543-2109', 'L004', 'ì´ì„ ìƒ', '', '2005-09-25', 'ì—¬', '2024-03-01', 'ê´‘ì£¼ê³ ', '1-3']
            ];
            
            console.log('ë°ëª¨ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', sheetsData.length, 'í–‰');
            
            // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('loading').style.display = 'none';
            updateDashboard();
            
            // ì‚¬ìš©ìì—ê²Œ ë°ëª¨ ëª¨ë“œì„ì„ ì•Œë¦¼
            const header = document.querySelector('.header');
            const demoNotice = document.createElement('div');
            demoNotice.style.cssText = `
                background: linear-gradient(135deg, #f59e0b, #f97316);
                color: white;
                padding: 10px 20px;
                border-radius: 10px;
                margin-top: 15px;
                text-align: center;
                font-weight: 600;
            `;
            demoNotice.innerHTML = 'ğŸ“‹ ë°ëª¨ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ ë°ì´í„° ì—°ê²°ì„ ìœ„í•´ì„œëŠ” êµ¬ê¸€ ì‹œíŠ¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
            header.appendChild(demoNotice);
        }

        // í†µê³„ ê³„ì‚° (Dì—´ ìƒíƒœ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •)
        function calculateStats() {
            console.log('í†µê³„ ê³„ì‚° ì‹œì‘, ë°ì´í„° í–‰ ìˆ˜:', sheetsData.length);
            
            if (!sheetsData || sheetsData.length <= 1) {
                console.warn('ë°ì´í„°ê°€ ì—†ê±°ë‚˜ í—¤ë”ë§Œ ìˆìŠµë‹ˆë‹¤.');
                return {
                    total: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                    male: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                    female: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                    buildings: {},
                    managers: {},
                    areas: {}
                };
            }
            
            const stats = {
                total: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                male: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                female: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                libraryA: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                libraryB: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                libraryC: { current: 0, out: 0, new: 0, moveOut: 0, moveIn: 0, absent: 0, exit: 0 },
                buildings: {},
                managers: {},
                areas: {}
            };

            // ê° ë™ë³„ë¡œ ì´ˆê¸°í™”
            Object.keys(buildingInfo).forEach(building => {
                stats.buildings[building] = {
                    floors: { '1': 0, '2': 0, '3': 0, '4': 0 },
                    total: 0,
                    gender: buildingInfo[building].gender
                };
            });

            // ë‹´ë‹¹ìë³„ í†µê³„ ì´ˆê¸°í™”
            Object.keys(managerInfo).forEach(manager => {
                stats.managers[manager] = {
                    areas: managerInfo[manager],
                    current: 0,
                    out: 0,
                    new: 0,
                    moveOut: 0,
                    moveIn: 0,
                    absent: 0,
                    exit: 0,
                    total: 0
                };
            });

            // êµ¬ì—­ë³„(ì¸µë³„) í†µê³„ ì´ˆê¸°í™”
            stats.areas = {};
            Object.keys(managerInfo).forEach(manager => {
                const area = managerInfo[manager][0]; // ê° ë‹´ë‹¹ìëŠ” í•˜ë‚˜ì˜ êµ¬ì—­ë§Œ ë‹´ë‹¹
                stats.areas[area] = {
                    manager: manager,
                    current: 0,
                    out: 0,
                    new: 0,
                    moveOut: 0,
                    moveIn: 0,
                    absent: 0,
                    exit: 0,
                    total: 0
                };
            });

            let processedCount = 0;

            // ì‹œíŠ¸ ë°ì´í„° ë¶„ì„ (í—¤ë” ì œì™¸í•˜ê³  1ë²ˆ ì¸ë±ìŠ¤ë¶€í„°)
            for (let index = 1; index < sheetsData.length; index++) {
                const row = sheetsData[index];
                
                // CSVì—ì„œ ë³€í™˜ëœ ë°ì´í„° êµ¬ì¡°: [ì¸ë±ìŠ¤, Bì—´, Cì—´, Dì—´, Eì—´, ...]
                // ì›ë˜ ì‹œíŠ¸: Bì—´=ê¸°ìˆ™ì‚¬ë²ˆí˜¸, Cì—´=ì´ë¦„, Dì—´=ìƒíƒœ
                const room = row[1]; // Bì—´ (ê¸°ìˆ™ì‚¬ ë²ˆí˜¸)
                const name = row[2]; // Cì—´ (í•™ìƒ ì´ë¦„)  
                const status = row[3] || 'ì •ìƒ'; // Dì—´ (ìƒíƒœ)
                const librarySeats = row[8] || ''; // Iì—´ (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¢Œì„)
                // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                if (!room || !name || name === 'ë¯¸ë°°ì •' || name.trim() === '') {
                    continue;
                }

                processedCount++;

                // ê±´ë¬¼ê³¼ ì¸µ ì¶”ì¶œ
                const building = room.toString().charAt(0).toUpperCase();
                const floor = room.toString().charAt(1);

                // ê±´ë¬¼ ì •ë³´ í™•ì¸
                if (!buildingInfo[building]) {
                    console.warn('ì•Œ ìˆ˜ ì—†ëŠ” ê±´ë¬¼:', building, 'in room:', room);
                    continue;
                }

                const buildingGender = buildingInfo[building].gender;

                // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
                updateStatsByStatus(stats.total, status);
                
                // ì„±ë³„ í†µê³„ ì—…ë°ì´íŠ¸
                if (buildingGender === 'male') {
                    updateStatsByStatus(stats.male, status);
                } else if (buildingGender === 'female') {
                    updateStatsByStatus(stats.female, status);
                }
// ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ í†µê³„ ì—…ë°ì´íŠ¸
                let library = '';
                if (librarySeats) {
                    const firstChar = librarySeats.toString().charAt(0).toUpperCase();
                    if (firstChar === 'A') library = 'A';
                    else if (firstChar === 'B') library = 'B';
                    else if (firstChar === 'C') library = 'C';
                }

                if (library === 'A') {
                    updateStatsByStatus(stats.libraryA, status);
                } else if (library === 'B') {
                    updateStatsByStatus(stats.libraryB, status);
                } else if (library === 'C') {
                    updateStatsByStatus(stats.libraryC, status);
                }
                // ë™ë³„ í†µê³„ ì—…ë°ì´íŠ¸ (í˜„ì¬ì›ë§Œ)
                if (stats.buildings[building] && ['ì •ìƒ', 'ì‹ ê·œ', 'ì´ë™+'].includes(status)) {
                    if (floor >= '1' && floor <= '4') {
                        stats.buildings[building].floors[floor]++;
                        stats.buildings[building].total++;
                    }
                }

                // ë‹´ë‹¹ìë³„ í†µê³„ ì—…ë°ì´íŠ¸
                const areaKey = `${building}ë™${floor}ì¸µ`;
                Object.keys(managerInfo).forEach(manager => {
                    if (managerInfo[manager].includes(areaKey)) {
                        updateStatsByStatus(stats.managers[manager], status);
                        stats.managers[manager].total++;
                    }
                });

                // êµ¬ì—­ë³„ í†µê³„ ì—…ë°ì´íŠ¸
                if (stats.areas[areaKey]) {
                    updateStatsByStatus(stats.areas[areaKey], status);
                    stats.areas[areaKey].total++;
                }
            }

            console.log('ì²˜ë¦¬ëœ í•™ìƒ ìˆ˜:', processedCount);
            console.log('ê³„ì‚°ëœ í†µê³„:', stats);
            
            return stats;
        }

        // ìƒíƒœë³„ í†µê³„ ì—…ë°ì´íŠ¸ (ìˆ˜ì •ëœ ë¡œì§)
        function updateStatsByStatus(statObj, status) {
            switch (status) {
                case 'ì •ìƒ':
                    statObj.current++;
                    break;
                case 'ì‹ ê·œ':
                    statObj.current++;
                    statObj.new++;
                    break;
                case 'ì´ë™+':
                    statObj.current++;
                    statObj.moveIn++;
                    break;
                case 'ì™¸ë°•':
                    statObj.out++;
                    break;
                case 'ì´ë™-':
                    statObj.moveOut++;
                    break;
                case 'ë“±ë¯¸':
                    statObj.absent++;
                    break;
                case 'í‡´ì†Œ':
                    statObj.exit++;
                    break;
                default:
                    // ê¸°ë³¸ê°’ ì²˜ë¦¬ (ì •ìƒìœ¼ë¡œ ê°„ì£¼)
                    statObj.current++;
                    break;
            }
        }

        // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
        function updateTotalStats(stats) {
            document.getElementById('totalCurrent').textContent = stats.total.current;
            document.getElementById('totalOut').textContent = stats.total.out;
            document.getElementById('totalNew').textContent = stats.total.new;
            document.getElementById('totalMove').textContent = stats.total.moveOut + stats.total.moveIn;
            document.getElementById('totalAbsent').textContent = stats.total.absent;
            document.getElementById('totalExit').textContent = stats.total.exit;
        }

        // ì„±ë³„ í†µê³„ ì—…ë°ì´íŠ¸
        function updateGenderStats(stats) {
            // ë‚¨í•™ìƒ
            document.getElementById('maleCurrent').textContent = stats.male.current;
            document.getElementById('maleOut').textContent = stats.male.out;
            document.getElementById('maleNew').textContent = stats.male.new;
            document.getElementById('maleAbsent').textContent = stats.male.absent;
            document.getElementById('maleMoveOut').textContent = stats.male.moveOut;
            document.getElementById('maleMoveIn').textContent = stats.male.moveIn;
            document.getElementById('maleExit').textContent = stats.male.exit;

            // ì—¬í•™ìƒ
            document.getElementById('femaleCurrent').textContent = stats.female.current;
            document.getElementById('femaleOut').textContent = stats.female.out;
            document.getElementById('femaleNew').textContent = stats.female.new;
            document.getElementById('femaleAbsent').textContent = stats.female.absent;
            document.getElementById('femaleMoveOut').textContent = stats.female.moveOut;
            document.getElementById('femaleMoveIn').textContent = stats.female.moveIn;
            document.getElementById('femaleExit').textContent = stats.female.exit;
        }
// ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ í†µê³„ ì—…ë°ì´íŠ¸
        function updateLibraryStats(stats) {
            // Aë¼ì´ë¸ŒëŸ¬ë¦¬
            document.getElementById('libraryACurrent').textContent = stats.libraryA.current;
            document.getElementById('libraryAOut').textContent = stats.libraryA.out;
            document.getElementById('libraryANew').textContent = stats.libraryA.new;
            document.getElementById('libraryAAbsent').textContent = stats.libraryA.absent;
            document.getElementById('libraryAMoveOut').textContent = stats.libraryA.moveOut;
            document.getElementById('libraryAMoveIn').textContent = stats.libraryA.moveIn;
            document.getElementById('libraryAExit').textContent = stats.libraryA.exit;

            // Bë¼ì´ë¸ŒëŸ¬ë¦¬
            document.getElementById('libraryBCurrent').textContent = stats.libraryB.current;
            document.getElementById('libraryBOut').textContent = stats.libraryB.out;
            document.getElementById('libraryBNew').textContent = stats.libraryB.new;
            document.getElementById('libraryBAbsent').textContent = stats.libraryB.absent;
            document.getElementById('libraryBMoveOut').textContent = stats.libraryB.moveOut;
            document.getElementById('libraryBMoveIn').textContent = stats.libraryB.moveIn;
            document.getElementById('libraryBExit').textContent = stats.libraryB.exit;

            // Cë¼ì´ë¸ŒëŸ¬ë¦¬
            document.getElementById('libraryCCurrent').textContent = stats.libraryC.current;
            document.getElementById('libraryCOut').textContent = stats.libraryC.out;
            document.getElementById('libraryCNew').textContent = stats.libraryC.new;
            document.getElementById('libraryCAbsent').textContent = stats.libraryC.absent;
            document.getElementById('libraryCMoveOut').textContent = stats.libraryC.moveOut;
            document.getElementById('libraryCMoveIn').textContent = stats.libraryC.moveIn;
            document.getElementById('libraryCExit').textContent = stats.libraryC.exit;
        }

        // ë¼ì´ë¸ŒëŸ¬ë¦¬ + ìƒíƒœë³„ í•™ìƒ ë³´ê¸°
        function showStudentsByLibrary(library, status) {
            const students = getStudentsByLibraryAndStatus(library, status);
            const statusText = getStatusText(status);
            showStudentsModal(`${library}ë¼ì´ë¸ŒëŸ¬ë¦¬ ${statusText} ëª©ë¡`, students);
        }

 // ë¼ì´ë¸ŒëŸ¬ë¦¬ + ìƒíƒœë³„ í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getStudentsByLibraryAndStatus(library, status) {
            const students = [];
            
            sheetsData.forEach((row, index) => {
                if (index === 0) return;
                
                const room = row[1];
                const name = row[2];
                const studentStatus = row[3] || 'ì •ìƒ';
                const librarySeats = row[8] || '';
                
                if (!room || !name || name === 'ë¯¸ë°°ì •') return;
                
                // ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                if (!librarySeats) return;
                const firstChar = librarySeats.toString().charAt(0).toUpperCase();
                if (firstChar !== library) return;
                
                // ìƒíƒœë³„ í•„í„°ë§
                if (status === 'total') {
                    if (studentStatus === 'ì •ìƒ' || studentStatus === 'ì‹ ê·œ' || studentStatus === 'ì´ë™+') {
                        students.push(row);
                    }
                } else if (studentStatus === status) {
                    students.push(row);
                }
            });
            
            // ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¢Œì„ ë²ˆí˜¸ìˆœìœ¼ë¡œ ì •ë ¬
            students.sort((a, b) => {
                const seatA = a[8] || '';
                const seatB = b[8] || '';
                
                // ì¢Œì„ ë²ˆí˜¸ì—ì„œ ìˆ«ì ë¶€ë¶„ ì¶”ì¶œí•˜ì—¬ ë¹„êµ
                const numA = parseInt(seatA.replace(/[^0-9]/g, '')) || 0;
                const numB = parseInt(seatB.replace(/[^0-9]/g, '')) || 0;
                
                return numA - numB;
            });
            
            return students;
        }
        // ë™ë³„ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì œê±°ë¨

        // êµ¬ì—­ë³„ ë‹´ë‹¹ì í†µê³„ ì—…ë°ì´íŠ¸ (24ê°œ êµ¬ì—­)
        function updateAreaManagerStats(stats) {
            const areaManagersGrid = document.getElementById('areaManagersGrid');
            areaManagersGrid.innerHTML = '';

            // ë™ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í‘œì‹œ
            const buildings = ['A', 'B', 'C', 'D', 'E', 'F'];
            
            buildings.forEach(building => {
                const buildingInfo_detail = buildingInfo[building];
                
                // ë™ë³„ ê·¸ë£¹ ì»¨í…Œì´ë„ˆ ìƒì„±
                const buildingGroup = document.createElement('div');
                buildingGroup.className = 'building-group';
                
                // ë™ë³„ í—¤ë”
                const groupHeader = document.createElement('div');
                groupHeader.className = 'building-group-header';
                groupHeader.innerHTML = `
                    <div class="building-group-title">${building}ë™ (${buildingInfo_detail.type})</div>
                    <div class="building-group-subtitle">1ì¸µ~4ì¸µ ì¸ì› í˜„í™©</div>
                `;
                buildingGroup.appendChild(groupHeader);
                
                // ì¸µë³„ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ
                const floorsGrid = document.createElement('div');
                floorsGrid.className = 'floors-grid';
                
                // ê° ì¸µë³„ ì¹´ë“œ ìƒì„±
                for (let floor = 1; floor <= 4; floor++) {
                    const areaKey = `${building}ë™${floor}ì¸µ`;
                    const manager = Object.keys(managerInfo).find(mgr => 
                        managerInfo[mgr].includes(areaKey)
                    );
                    
                    // ê° êµ¬ì—­ë³„ ë…ë¦½ì ì¸ í†µê³„ ì‚¬ìš©
                    const areaData = stats.areas[areaKey];
                    
                    if (manager && areaData) {
                        const areaCard = document.createElement('div');
                        areaCard.className = 'area-manager-card';
areaCard.innerHTML = `
    <div class="area-manager-header">
        <div class="area-manager-name">${manager}</div>
        <div class="area-manager-zone" style="font-size: 1.8rem; font-weight: 800;">${building}ë™${floor}ì¸µ</div>
    </div>
                            <div class="area-stats-compact">
                                <div class="area-stat-item current" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'current')">
                                    <div class="area-stat-number">${areaData.current}</div>
                                    <div class="area-stat-label">í˜„ì¬ì›</div>
                                </div>
                                <div class="area-stat-item out" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'out')">
                                    <div class="area-stat-number">${areaData.out}</div>
                                    <div class="area-stat-label">ì™¸ë°•</div>
                                </div>
                                <div class="area-stat-item new" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'new')">
                                    <div class="area-stat-number">${areaData.new}</div>
                                    <div class="area-stat-label">ì‹ ê·œ</div>
                                </div>
                                <div class="area-stat-item absent" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'absent')">
                                    <div class="area-stat-number">${areaData.absent}</div>
                                    <div class="area-stat-label">ë“±ë¯¸</div>
                                </div>
                            </div>
                            <div class="area-stats-compact">
                                <div class="area-stat-item move-out" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'moveOut')">
                                    <div class="area-stat-number">${areaData.moveOut}</div>
                                    <div class="area-stat-label">ì´ë™-</div>
                                </div>
                                <div class="area-stat-item move-in" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'moveIn')">
                                    <div class="area-stat-number">${areaData.moveIn}</div>
                                    <div class="area-stat-label">ì´ë™+</div>
                                </div>
                                <div class="area-stat-item exit" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'exit')">
                                    <div class="area-stat-number">${areaData.exit}</div>
                                    <div class="area-stat-label">í‡´ì†Œ</div>
                                </div>
                                <div class="area-stat-item" onclick="showAreaManagerStudents('${manager}', '${areaKey}', 'total')">
                                    <div class="area-stat-number">${areaData.total}</div>
                                    <div class="area-stat-label">ì „ì²´</div>
                                </div>
                            </div>
                            <div class="area-total-summary">
                                ì´ ${areaData.total}ëª… ë‹´ë‹¹
                            </div>
                        `;
                        floorsGrid.appendChild(areaCard);
                    }
                }
                
                buildingGroup.appendChild(floorsGrid);
                areaManagersGrid.appendChild(buildingGroup);
            });
        }

        // êµ¬ì—­ë³„ ë‹´ë‹¹ì í•™ìƒ ë³´ê¸°
        function showAreaManagerStudents(manager, areaKey, statusType) {
            const students = getStudentsByAreaManager(manager, areaKey, statusType);
            const statusText = getStatusText(statusType);
            showStudentsModal(`${manager} - ${areaKey} ${statusText} í•™ìƒ ëª©ë¡`, students);
        }

        // êµ¬ì—­ë³„ ë‹´ë‹¹ì í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getStudentsByAreaManager(manager, areaKey, statusType) {
            const students = [];
            
            // areaKeyì—ì„œ ë™ê³¼ ì¸µ ì¶”ì¶œ (ì˜ˆ: "Aë™1ì¸µ" -> A, 1)
            const building = areaKey.charAt(0);
            const floor = areaKey.charAt(2);
            
            sheetsData.forEach((row, index) => {
                if (index === 0) return;
                
                const room = row[1];
                const name = row[2];
                const status = row[3] || 'ì •ìƒ';
                
                if (!room || !name || name === 'ë¯¸ë°°ì •') return;
                
                // í•´ë‹¹ êµ¬ì—­ì˜ ë°©ì¸ì§€ í™•ì¸
                const roomBuilding = room.toString().charAt(0).toUpperCase();
                const roomFloor = room.toString().charAt(1);
                
                if (roomBuilding !== building || roomFloor !== floor) return;
                
                // ìƒíƒœë³„ í•„í„°ë§
                let shouldInclude = false;
                switch (statusType) {
                    case 'current':
                        shouldInclude = (status === 'ì •ìƒ' || status === 'ì‹ ê·œ' || status === 'ì´ë™+');
                        break;
                    case 'out':
                        shouldInclude = (status === 'ì™¸ë°•');
                        break;
                    case 'new':
                        shouldInclude = (status === 'ì‹ ê·œ');
                        break;
                    case 'moveOut':
                        shouldInclude = (status === 'ì´ë™-');
                        break;
                    case 'moveIn':
                        shouldInclude = (status === 'ì´ë™+');
                        break;
                    case 'absent':
                        shouldInclude = (status === 'ë“±ë¯¸');
                        break;
                    case 'exit':
                        shouldInclude = (status === 'í‡´ì†Œ');
                        break;
                    case 'total':
                        shouldInclude = true;
                        break;
                }
                
                if (shouldInclude) {
                    students.push(row);
                }
            });
            
            return students;
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');

            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }

                if (query.length < 1) {
                    searchResults.style.display = 'none';
                    return;
                }

                searchTimeout = setTimeout(() => {
                    performSearch(query);
                }, 300);
            });

            // ê²€ìƒ‰ ê²°ê³¼ ì™¸ë¶€ í´ë¦­ ì‹œ ìˆ¨ê¹€
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
        }

        // ì‹¤ì‹œê°„ ê²€ìƒ‰ ìˆ˜í–‰ (ìˆ˜ì •: í–‰ ì¸ë±ìŠ¤ ì¶”ê°€)
// ì‹¤ì‹œê°„ ê²€ìƒ‰ ìˆ˜í–‰ (ìˆ˜ì •: AFì‹œíŠ¸ ì§ì ‘ ê²€ìƒ‰ ì¶”ê°€)
function performSearch(query) {
    const searchResults = document.getElementById('searchResults');
    const extendedSearch = document.getElementById('extendedSearchCheckbox').checked;
    const results = [];
    const lowerQuery = query.toLowerCase();

    console.log('=== ê²€ìƒ‰ ì‹œì‘ ===');
    console.log('ê²€ìƒ‰ì–´:', query);
    console.log('í™•ì¥ ê²€ìƒ‰:', extendedSearch);

    // 1. ê¸°ì¡´ ì‹œíŠ¸ì—ì„œ ê²€ìƒ‰
    sheetsData.forEach((row, index) => {
        if (index === 0) return; // í—¤ë” ì œì™¸

        const room = row[1] || '';
        const name = row[2] || '';
        const status = row[3] || 'ì •ìƒ';
        const librarySeats = row[8] || '';
        const phone = row[7] || '';
        const parentPhone = row[6] || '';
        const qColumn = row[16] || '';

        const searchFields = [
            room.toLowerCase(),
            name.toLowerCase(),
            librarySeats.toLowerCase(),
            phone,
            parentPhone,
            qColumn.toLowerCase()
        ].join(' ');

        if (searchFields.includes(lowerQuery) && name && name !== 'ë¯¸ë°°ì •') {
            let additionalNotes = [];
            if (extendedSearch && afSheetData.length > 0) {
                const afMatches = afSheetData.filter(afRow => 
                    afRow.nameB === name || afRow.nameG === name
                );
                additionalNotes = afMatches.map(match => match.note).filter(note => note);
            }
            
            results.push({
                room: room,
                name: name,
                status: status,
                rowData: row,
                rowIndex: index,
                additionalNotes: additionalNotes,
                source: 'main'
            });
        }
    });

    console.log('ê¸°ì¡´ ì‹œíŠ¸ ê²€ìƒ‰ ê²°ê³¼:', results.length);

    // 2. í™•ì¥ ê²€ìƒ‰: í‡´ì†Œí•™ìƒ ì‹œíŠ¸ì—ì„œ ê²€ìƒ‰ (AFë³´ë‹¤ ë¨¼ì €)
    if (extendedSearch && exitedStudentsData.length > 0) {
        console.log('í‡´ì†Œí•™ìƒ ê²€ìƒ‰ ì‹œì‘, ë°ì´í„° ìˆ˜:', exitedStudentsData.length);
        
        const foundNames = new Set(results.map(r => r.name));
        let exitedMatchCount = 0;
        
        exitedStudentsData.forEach((exitedStudent) => {
            const studentName = exitedStudent.name.toLowerCase();
            
            // ì´ë¦„ì´ ê²€ìƒ‰ì–´ë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸
            if (studentName.includes(lowerQuery)) {
                
                // ê¸°ì¡´ ì‹œíŠ¸ì—ì„œ ì°¾ì§€ ëª»í•œ ê²½ìš°ì—ë§Œ ì¶”ê°€
                if (!foundNames.has(exitedStudent.name)) {
                    exitedMatchCount++;
                    
                    console.log('í‡´ì†Œí•™ìƒ ë§¤ì¹­:', exitedStudent.name);
                    
                    results.push({
                        room: 'í‡´ì†Œí•™ìƒ',
                        name: exitedStudent.name,
                        status: 'í‡´ì†Œ',
                        rowData: null,
                        rowIndex: -2,
                        additionalNotes: [],
                        source: 'exited',
                        exitedData: exitedStudent
                    });
                    
                    foundNames.add(exitedStudent.name);
                }
            }
        });
        
        console.log('í‡´ì†Œí•™ìƒ ê²€ìƒ‰ ì™„ë£Œ, ë§¤ì¹­ ìˆ˜:', exitedMatchCount);
    }

    // 3. í™•ì¥ ê²€ìƒ‰: AF ì‹œíŠ¸ì—ì„œ ì¶”ê°€ ê²€ìƒ‰
    if (extendedSearch && afSheetData.length > 0) {
        console.log('AF ì‹œíŠ¸ ê²€ìƒ‰ ì‹œì‘');
        
        const foundNames = new Set(results.map(r => r.name));
        
        afSheetData.forEach((afRow, index) => {
            const nameB = afRow.nameB.toLowerCase();
            const nameG = afRow.nameG.toLowerCase();
            
            if ((nameB.includes(lowerQuery) || nameG.includes(lowerQuery))) {
                const displayName = afRow.nameB || afRow.nameG;
                
                if (!foundNames.has(displayName)) {
                    const allNotes = afSheetData
                        .filter(af => af.nameB === displayName || af.nameG === displayName)
                        .map(af => af.note)
                        .filter(n => n);
                    
                    results.push({
                        room: 'AFì‹œíŠ¸',
                        name: displayName,
                        status: 'AFì •ë³´',
                        rowData: null,
                        rowIndex: -1,
                        additionalNotes: allNotes,
                        source: 'af'
                    });
                    
                    foundNames.add(displayName);
                }
            }
        });
    }

    console.log('ì „ì²´ ê²€ìƒ‰ ê²°ê³¼:', results.length);
    console.log('ê²°ê³¼ ìƒì„¸:', results.map(r => ({name: r.name, source: r.source})));

    displaySearchResults(results, extendedSearch);
}
        // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ (ìˆ˜ì •: í–‰ ì¸ë±ìŠ¤ ê¸°ë°˜ í´ë¦­)
       // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ (ìˆ˜ì •: AFì‹œíŠ¸ ì „ìš© ê²°ê³¼ í‘œì‹œ ì¶”ê°€)
// ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ (ìˆ˜ì •: ì—¬ëŸ¬ AFì‹œíŠ¸ ì •ë³´ í‘œì‹œ)
function displaySearchResults(results, extendedSearch) {
    const searchResults = document.getElementById('searchResults');
    
    console.log('ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ ì‹œì‘, ê²°ê³¼ ìˆ˜:', results.length);
    
    if (results.length === 0) {
        searchResults.innerHTML = '<div class="search-result-item">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
        searchResults.innerHTML = results.map((result) => {
            console.log('ê²°ê³¼ í‘œì‹œ:', result.name, 'source:', result.source);
            
            // í‡´ì†Œí•™ìƒ ì‹œíŠ¸ì—ë§Œ ìˆëŠ” ë°ì´í„°ì¸ ê²½ìš°
            if (result.source === 'exited') {
                const exitedDataStr = JSON.stringify(result.exitedData);
                
                return `
                    <div class="search-result-item" style="background: #fee2e2; border-left: 4px solid #dc2626;" onclick='showExitedStudentDetail(\`${exitedDataStr}\`)'>
                        <div class="result-room" style="color: #dc2626; font-weight: 700;">ğŸšª í‡´ì†Œ í•™ìƒ ì •ë³´</div>
                        <div class="result-name" style="font-size: 1.1rem; font-weight: 600; color: #7f1d1d;">${result.name}</div>
                        <div class="result-status" style="color: #991b1b; margin-top: 5px;">ìƒíƒœ: í‡´ì†Œ</div>
                        <div style="margin-top: 8px; padding: 6px 10px; background: white; border-radius: 6px; font-size: 0.85rem; color: #991b1b;">
                            âš ï¸ í‡´ì†Œí•œ í•™ìƒì˜ ê¸°ë¡ì…ë‹ˆë‹¤. í´ë¦­í•˜ì—¬ ìƒì„¸ì •ë³´ í™•ì¸
                        </div>
                    </div>
                `;
            }
            
            // AF ì‹œíŠ¸ì—ë§Œ ìˆëŠ” ë°ì´í„°ì¸ ê²½ìš°
            if (result.source === 'af') {
                const notesHtml = result.additionalNotes.length > 0 
                    ? result.additionalNotes.map((note, idx) => `
                        <div style="margin-top: 5px; padding: 5px 10px; background: white; border-radius: 6px; font-size: 0.85rem; color: #92400e; border-left: 3px solid #f59e0b;">
                            <strong>${idx + 1}.</strong> ${note}
                        </div>
                    `).join('')
                    : '<div style="margin-top: 5px; font-size: 0.9rem; color: #92400e;">ìƒì„¸ ì •ë³´ ì—†ìŒ</div>';
                
                return `
                    <div class="search-result-item" style="background: #fef3c7;">
                        <div class="result-room" style="color: #f59e0b;">â—† ê¸°ìˆ™ì‚¬ì´ë ¥ ë° í‡´ì†Œ(ìƒ)ì •ë³´ í¬í•¨ (${result.additionalNotes.length}ê±´)</div>
                        <div class="result-name">${result.name}</div>
                        ${notesHtml}
                        <div style="margin-top: 5px; font-size: 0.8rem; color: #6b7280;">
                            â€» ê¸°ì¡´ ì‹œíŠ¸ì— ì—†ëŠ” ì •ë³´ì…ë‹ˆë‹¤
                        </div>
                    </div>
                `;
            }
            
            // ê¸°ì¡´ ì‹œíŠ¸ ë°ì´í„°ì¸ ê²½ìš°
            const additionalNotesHtml = extendedSearch && result.additionalNotes && result.additionalNotes.length > 0
                ? result.additionalNotes.map((note, idx) => `
                    <div style="margin-top: 3px; padding: 5px 10px; background: #fef3c7; border-radius: 6px; font-size: 0.85rem; color: #92400e;">
                        â—† ${result.additionalNotes.length > 1 ? `${idx + 1}. ` : ''}${note}
                    </div>
                `).join('')
                : '';
            
            return `
                <div class="search-result-item" onclick="showStudentDetailByIndex(${result.rowIndex}, ${extendedSearch && result.additionalNotes ? `'${result.additionalNotes.join(' | ').replace(/'/g, "\\'")}'` : 'null'})">
                    <div class="result-room">${result.room}</div>
                    <div class="result-name">${result.name}</div>
                    <div class="result-status">ìƒíƒœ: ${result.status}</div>
                    ${additionalNotesHtml}
                </div>
            `;
        }).join('');
    }
    
    searchResults.style.display = 'block';
}
        // ìƒíƒœë³„ í•™ìƒ ë³´ê¸°
        function showStudentsByStatus(status) {
            const students = getStudentsByStatus(status);
            showStudentsModal(`${status} í•™ìƒ ëª©ë¡`, students);
        }

        // ì„±ë³„ + ìƒíƒœë³„ í•™ìƒ ë³´ê¸°
        function showStudentsByGender(gender, status) {
            const students = getStudentsByGenderAndStatus(gender, status);
            const genderText = gender === 'male' ? 'ë‚¨í•™ìƒ' : 'ì—¬í•™ìƒ';
            showStudentsModal(`${genderText} ${status} ëª©ë¡`, students);
        }

        // ì¸µë³„ í•™ìƒ ë³´ê¸°
        function showFloorStudents(building, floor) {
            const students = getStudentsByFloor(building, floor);
            showStudentsModal(`${building}ë™ ${floor}ì¸µ í•™ìƒ ëª©ë¡`, students);
        }

        // ë‹´ë‹¹ìë³„ í•™ìƒ ë³´ê¸°
        function showManagerStudents(manager, statusType) {
            const students = getStudentsByManager(manager, statusType);
            const statusText = getStatusText(statusType);
            showStudentsModal(`${manager} - ${statusText} í•™ìƒ ëª©ë¡`, students);
        }

        // íŠ¹ì • í•™ìƒ ìƒì„¸ ì •ë³´ ë³´ê¸° (ê¸°ì¡´ ë°©ì‹ - í˜¸ì‹¤ ê¸°ì¤€)
        function showStudentDetail(room) {
            const student = sheetsData.find(row => row[1] === room);
            if (student) {
                showStudentsModal(`${room} í•™ìƒ ì •ë³´`, [student]);
            }
            document.getElementById('searchResults').style.display = 'none';
        }

        // ì¸ë±ìŠ¤ë¡œ íŠ¹ì • í•™ìƒ ìƒì„¸ ì •ë³´ ë³´ê¸° (ìƒˆë¡œìš´ ë°©ì‹ - ì •í™•í•œ í•™ìƒ ì„ íƒ)
        function showStudentDetailByIndex(rowIndex, additionalNote = null) {
    const student = sheetsData[rowIndex];
    if (student) {
        const room = student[1] || '';
        const name = student[2] || '';
        showStudentsModal(`${room} ${name} í•™ìƒ ì •ë³´`, [student], additionalNote);
    }
    document.getElementById('searchResults').style.display = 'none';
}
        // í‡´ì†Œí•™ìƒ ìƒì„¸ ì •ë³´ í‘œì‹œ
// í‡´ì†Œí•™ìƒ ìƒì„¸ ì •ë³´ í‘œì‹œ
function showExitedStudentDetail(exitedDataStr) {
    try {
        const exitedData = JSON.parse(exitedDataStr);
        
        document.getElementById('modalTitle').textContent = 'ğŸšª í‡´ì†Œ í•™ìƒ ìƒì„¸ ì •ë³´';
        const modalStudentsGrid = document.getElementById('modalStudentsGrid');
        
        const headers = exitedData.headers || [];
        const row = exitedData.fullRow || [];
        
        // í—¤ë”ì™€ ë°ì´í„°ë¥¼ ë§¤ì¹­í•˜ì—¬ í‘œì‹œ
        let detailsHtml = '';
        for (let i = 0; i < headers.length && i < row.length; i++) {
            if (row[i] && row[i].trim()) {
                detailsHtml += `
                    <div class="detail-item">
                        <div class="detail-label">${headers[i] || `í•­ëª© ${i + 1}`}</div>
                        <div class="detail-value">${row[i]}</div>
                    </div>
                `;
            }
        }
        
        const infoCard = `
            <div class="student-info-card" style="border-left-color: #dc2626;">
                <div class="student-info-header">
                    <div class="student-room">ğŸšª í‡´ì†Œ í•™ìƒ</div>
                    <div class="student-status status-exit">í‡´ì†Œ</div>
                </div>
                <div class="student-details">
                    ${detailsHtml}
                    <div class="detail-item" style="grid-column: 1 / -1; margin-top: 15px;">
                        <div class="detail-label">ë¹„ê³ </div>
                        <div class="detail-value" style="background: #fee2e2; padding: 12px; border-radius: 8px; color: #991b1b; font-weight: 600;">
                            âš ï¸ ì´ í•™ìƒì€ í‡´ì†Œ í•™ìƒì…ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modalStudentsGrid.innerHTML = infoCard;
        document.getElementById('studentModal').style.display = 'block';
        document.getElementById('searchResults').style.display = 'none';
        
    } catch (error) {
        console.error('í‡´ì†Œí•™ìƒ ì •ë³´ í‘œì‹œ ì˜¤ë¥˜:', error);
        alert('í‡´ì†Œí•™ìƒ ì •ë³´ë¥¼ í‘œì‹œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}
        // ìƒíƒœë³„ í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getStudentsByStatus(status) {
            const students = [];
            
            sheetsData.forEach((row, index) => {
                if (index === 0) return;
                
                const name = row[2];
                const studentStatus = row[3] || 'ì •ìƒ';
                
                if (!name || name === 'ë¯¸ë°°ì •') return;
                
                if (status === 'total') {
                    if (studentStatus === 'ì •ìƒ' || studentStatus === 'ì‹ ê·œ' || studentStatus === 'ì´ë™+') {
                        students.push(row);
                    }
                } else if (status === 'ì´ë™') {
                    if (studentStatus === 'ì´ë™-' || studentStatus === 'ì´ë™+') {
                        students.push(row);
                    }
                } else if (studentStatus === status) {
                    students.push(row);
                }
            });
            
            return students;
        }

        // ë‹´ë‹¹ìë³„ í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getStudentsByManager(manager, statusType) {
            const students = [];
            const managerAreas = managerInfo[manager] || [];
            
            sheetsData.forEach((row, index) => {
                if (index === 0) return;
                
                const room = row[1];
                const name = row[2];
                const status = row[3] || 'ì •ìƒ';
                
                if (!room || !name || name === 'ë¯¸ë°°ì •') return;
                
                // ë‹´ë‹¹ êµ¬ì—­ í™•ì¸
                const building = room.toString().charAt(0).toUpperCase();
                const floor = room.toString().charAt(1);
                const areaKey = `${building}ë™${floor}ì¸µ`;
                
                if (!managerAreas.includes(areaKey)) return;
                
                // ìƒíƒœë³„ í•„í„°ë§
                let shouldInclude = false;
                switch (statusType) {
                    case 'current':
                        shouldInclude = (status === 'ì •ìƒ' || status === 'ì‹ ê·œ' || status === 'ì´ë™+');
                        break;
                    case 'out':
                        shouldInclude = (status === 'ì™¸ë°•');
                        break;
                    case 'new':
                        shouldInclude = (status === 'ì‹ ê·œ');
                        break;
                    case 'moveOut':
                        shouldInclude = (status === 'ì´ë™-');
                        break;
                    case 'moveIn':
                        shouldInclude = (status === 'ì´ë™+');
                        break;
                    case 'absent':
                        shouldInclude = (status === 'ë“±ë¯¸');
                        break;
                    case 'exit':
                        shouldInclude = (status === 'í‡´ì†Œ');
                        break;
                    case 'total':
                        shouldInclude = true;
                        break;
                }
                
                if (shouldInclude) {
                    students.push(row);
                }
            });
            
            return students;
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë°˜í™˜
        function getStatusText(statusType) {
            const statusTexts = {
                'current': 'í˜„ì¬ì›',
                'out': 'ì™¸ë°•',
                'new': 'ì‹ ê·œ',
                'moveOut': 'ì´ë™-',
                'moveIn': 'ì´ë™+',
                'absent': 'ë“±ë¯¸',
                'exit': 'í‡´ì†Œ',
                'total': 'ì „ì²´'
            };
            return statusTexts[statusType] || statusType;
        }

        // ì„±ë³„ + ìƒíƒœë³„ í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getStudentsByGenderAndStatus(gender, status) {
            const students = [];
            
            sheetsData.forEach((row, index) => {
                if (index === 0) return;
                
                const room = row[1];
                const name = row[2];
                const studentStatus = row[3] || 'ì •ìƒ';
                
                if (!room || !name || name === 'ë¯¸ë°°ì •') return;
                
                // ì„±ë³„ í™•ì¸
                const building = room.charAt(0);
                if (!buildingInfo[building] || buildingInfo[building].gender !== gender) return;
                
                // ìƒíƒœë³„ í•„í„°ë§
                if (status === 'total') {
                    if (studentStatus === 'ì •ìƒ' || studentStatus === 'ì‹ ê·œ' || studentStatus === 'ì´ë™+') {
                        students.push(row);
                    }
                } else if (studentStatus === status) {
                    students.push(row);
                }
            });
            
            return students;
        }

        // ì¸µë³„ í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getStudentsByFloor(building, floor) {
            const students = [];
            
            sheetsData.forEach((row, index) => {
                if (index === 0) return;
                
                const room = row[1];
                const name = row[2];
                const status = row[3] || 'ì •ìƒ';
                
                if (!room || !name || name === 'ë¯¸ë°°ì •') return;
                
                if (room.startsWith(building + floor)) {
                    if (status === 'ì •ìƒ' || status === 'ì‹ ê·œ' || status === 'ì´ë™+') {
                        students.push(row);
                    }
                }
            });
            
            return students;
        }

        // í•™ìƒ ëª¨ë‹¬ í‘œì‹œ
       function showStudentsModal(title, students, additionalNote = null) {
    document.getElementById('modalTitle').textContent = title;
    const modalStudentsGrid = document.getElementById('modalStudentsGrid');
    
    modalStudentsGrid.innerHTML = students.map(row => createStudentCard(row, additionalNote)).join('');
    document.getElementById('studentModal').style.display = 'block';
}

        // í•™ìƒ ì •ë³´ ì¹´ë“œ ìƒì„±
       function createStudentCard(row, additionalNote = null) {
            const room = row[1] || '';
            const name = row[2] || '';
            const status = row[3] || 'ì •ìƒ';
            const memo = row[5] || '';
           // ===== ìƒë‹´ ë‚´ìš© ì¶”ê°€ (R~Vì—´ = ì¸ë±ìŠ¤ 17~21) =====
    const counsel1 = row[17] || ''; // Rì—´
    const counsel2 = row[18] || ''; // Sì—´
    const counsel3 = row[19] || ''; // Tì—´
    const counsel4 = row[20] || ''; // Uì—´
    const counsel5 = row[21] || ''; // Vì—´
 // ìƒë‹´ ë‚´ìš© ë°°ì—´ë¡œ ì •ë¦¬
    const counselData = [counsel1, counsel2, counsel3, counsel4, counsel5]
        .filter(c => c && c.trim() !== '');
           
let finalMemo = memo;
    if (additionalNote && additionalNote !== 'null') {
        finalMemo = memo ? `${memo} | â—† ${additionalNote}` : `â—† ${additionalNote}`;
    }
            const parentPhone = row[6] || '';
            const phone = row[7] || '';
            const librarySeats = row[8] || '';
            const group = row[9] || '';  // ê·¸ë£¹ ì •ë³´ ì¶”ê°€ (Jì—´)
            const lifeTeacher = row[10] || '';  // ìƒí™œë‹´ì„ì€ Kì—´ë¡œ ì´ë™
            const birthDate = row[11] || '';
            const gender = row[12] || '';
            const enrollDate = row[13] || '';
            const school = row[14] || '';
            const classroom = row[15] || '';
           const qColumnData = row[16] || '';

            const statusClass = getStatusClass(status);

            return `
                <div class="student-info-card">
                    <div class="student-info-header">
                        <div class="student-room">${room}</div>
                        <div class="student-status ${statusClass}">${status}</div>
                    </div>
                    <div class="student-details">
                        <div class="detail-item">
                            <div class="detail-label">ì´ë¦„</div>
                            <div class="detail-value">${name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì„±ë³„</div>
                            <div class="detail-value">${gender}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ê·¸ë£¹</div>
                            <div class="detail-value">${group}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ìƒë…„ì›”ì¼</div>
                            <div class="detail-value">${birthDate}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ë³¸ì¸ì—°ë½ì²˜</div>
                            <div class="detail-value">${phone}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">í•™ë¶€ëª¨ì—°ë½ì²˜</div>
                            <div class="detail-value">${parentPhone}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¢Œì„</div>
                            <div class="detail-value">${librarySeats}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ë‹´ì„ì„ ìƒë‹˜</div>
                            <div class="detail-value">${lifeTeacher}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì…ì†Œì¼</div>
                            <div class="detail-value">${enrollDate}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ì¶œì‹ ê³ êµ</div>
                            <div class="detail-value">${school}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ë°˜</div>
                            <div class="detail-value">${classroom}</div>
                        </div>
                        ${qColumnData ? `
                    <div class="detail-item">
                        <div class="detail-label">ë¶€ë‹´ì„ì„ ìƒë‹˜</div>
                        <div class="detail-value">${qColumnData}</div>
                    </div>
                ` : ''}
                       ${finalMemo ? `
        <div class="detail-item" style="grid-column: 1 / -1;">
            <div class="detail-label">ë¹„ê³ </div>
            <div class="detail-value" style="background: ${additionalNote && additionalNote !== 'null' ? '#fef3c7' : 'transparent'}; padding: ${additionalNote && additionalNote !== 'null' ? '8px' : '0'}; border-radius: 6px;">${finalMemo}</div>
        </div>
    ` : ''}
     <!-- ===== ìƒë‹´ ë‚´ìš© ì„¹ì…˜ ì¶”ê°€ ===== -->
                ${counselData.length > 0 ? `
                    <div class="detail-item" style="grid-column: 1 / -1; margin-top: 15px;">
                        <div class="detail-label" style="font-size: 1.1rem; font-weight: 700; color: #4f46e5; margin-bottom: 10px;">
                            â—† ìƒë‹´ ê¸°ë¡ (${counselData.length}ê±´)
                        </div>
                        <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 15px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                            ${counselData.map((counsel, index) => `
                                <div style="margin-bottom: ${index < counselData.length - 1 ? '12px' : '0'}; padding-bottom: ${index < counselData.length - 1 ? '12px' : '0'}; border-bottom: ${index < counselData.length - 1 ? '1px solid #cbd5e1' : 'none'};">
                                    <div style="font-size: 0.75rem; color: #64748b; font-weight: 600; margin-bottom: 4px;">
                                        ${index + 1}ì°¨ ìƒë‹´
                                    </div>
                                    <div style="font-size: 0.9rem; color: #1e293b; line-height: 1.6; white-space: pre-wrap;">
                                        ${counsel}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}
        // ìƒíƒœ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getStatusClass(status) {
            switch (status) {
                case 'ì •ìƒ': return 'status-normal';
                case 'ì™¸ë°•': return 'status-out';
                case 'ì‹ ê·œ': return 'status-new';
                case 'ì´ë™-':
                case 'ì´ë™+': return 'status-move';
                case 'ë“±ë¯¸': return 'status-absent';
                case 'í‡´ì†Œ': return 'status-exit';
                default: return 'status-normal';
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('studentModal').style.display = 'none';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('studentModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        // ë¡œë”© í‘œì‹œ/ìˆ¨ê¹€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshData() {
             location.reload();
        }

        // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(refreshData, 60 * 60 * 1000);
    </script>
    </script>
    
    <!-- ê°œë°œì ë„êµ¬ ë°©ì§€ ì½”ë“œ -->
    <script>
        // F12 í‚¤ ë°©ì§€
        document.addEventListener('keydown', function(e) {
            // F12 í‚¤
            if (e.key === 'F12' || e.keyCode === 123) {
                e.preventDefault();
                return false;
            }
            
            // Ctrl+Shift+I (ê°œë°œì ë„êµ¬)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            
            // Ctrl+Shift+J (ì½˜ì†”)
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            
            // Ctrl+Shift+C (ìš”ì†Œ ê²€ì‚¬)
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                return false;
            }
            
            // Ctrl+U (ì†ŒìŠ¤ ë³´ê¸°)
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
            
            // Macìš©: Cmd+Option+I
            if (e.metaKey && e.altKey && e.key === 'i') {
                e.preventDefault();
                return false;
            }
            
            // Macìš©: Cmd+Option+J
            if (e.metaKey && e.altKey && e.key === 'j') {
                e.preventDefault();
                return false;
            }
            
            // Macìš©: Cmd+Option+C
            if (e.metaKey && e.altKey && e.key === 'c') {
                e.preventDefault();
                return false;
            }
        });
        



    </script>
</body>
</html>

